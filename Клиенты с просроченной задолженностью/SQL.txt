WITH t1 AS 
    (SELECT
        sl.[ID клиента],
        sl.[ID кредита],
        MAX(sl.[Дней просрочки]) OVER (PARTITION BY sl.[ID клиента], sl.[ID кредита]) AS [Последний день на ПЗ],
        MAX(sl.[Дата реестра]) OVER (PARTITION BY sl.[ID клиента], sl.[ID кредита]) AS [Дата выхода из просрочки],
        ul.[Номер займа  у клиента] 
    FROM Skill sl
    LEFT JOIN Unical ul ON sl.[ID клиента] = ul.[ID клиента] 
                                 AND sl.[ID кредита] = ul.[ID займа] 
    WHERE sl.[Дата реестра] >= '2024-01-01'
    GROUP BY 
         sl.[ID клиента],
         sl.[ID кредита], 
         sl.[Дата реестра],
         sl.[Дней просрочки],
         ul.[Номер займа  у клиента])
SELECT 
    [ID клиента],
    [ID кредита],
    [Группа по дню просрочки] = 
    CASE 
       WHEN [Последний день на ПЗ] <= 30 THEN '1-30'
       WHEN [Последний день на ПЗ] <= 60 THEN '31-60'
       WHEN [Последний день на ПЗ] <= 90 THEN '61-90'
       ELSE '90+' 
   END,
   [Номер займа] = [Номер займа  у клиента],
   [Дата выхода из просрочки]
FROM t1